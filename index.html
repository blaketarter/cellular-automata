<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <canvas id="canvas" height="400" width="400"></canvas>
  <script src="dist/bundle.js"></script>
  <script>
    const canvasEle = document.getElementById('canvas');

    const CELLS = {
      'air': {
        color: '#ffffff',
      },
      'rock': {
        color: '#000000',
      },
    };

    const OPTIONS = {
      rows: 25,
      columns: 25,
      cellSize: 25,
    };

    const world = new window.CA.World({
      rows: OPTIONS.rows,
      columns: OPTIONS.columns,
    });

    // world.addAgent('air', { wasAlive: false, isAlive: false });
    world.addAgent('rock', { isAlive: true });

    world.addRule((agent, neighbors) => {
      const existingNeighbors = neighbors.filter(agent => agent);
      const aliveNeighbors = existingNeighbors.filter(agent => agent.isAlive);

      if (existingNeighbors.length < 8) {
        return { ...agent, isAlive: true, };
      }

      if (aliveNeighbors.length > 4) {
        return { ...agent, isAlive: true, };
      }

      if (aliveNeighbors.length < 3) {
        return { ...agent, isAlive: false, };
      }

      return agent;
    });

    world.fillWithDistribution([{
      agent: 'rock',
      chance: 0.65,
      state: { isAlive: false, },
    }, {
      agent: 'rock',
      chance: 0.35,
      state: { isAlive: true, },
    }]);

    console.log(world);

    const map = new window.CA.GameMap(canvasEle);

    // map.renderWorld(world, OPTIONS.cellSize, cell => {
    //   if (cell.isAlive) {
    //     return CELLS['rock'];
    //   }

    //   return CELLS['air'];
    // });

    world.delay(15);

    map.renderWorld(world, OPTIONS.cellSize, cell => {
      if (cell.isAlive) {
        return CELLS['rock'];
      }

      return CELLS['air'];
    });

    console.log(map);
  </script>
</body>

</html>
